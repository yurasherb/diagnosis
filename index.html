<script type="text/babel">
    const { useState, useEffect } = React;

    // Lucide React Icons („Ç§„É≥„É©„Ç§„É≥ÂÆüË£Ö)
    const ChevronRight = ({ className, style }) => (
        <svg className={className} style={style} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
            <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
    );

    const Coffee = ({ className }) => (
        <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
            <path d="M18 8h1a4 4 0 0 1 0 8h-1"></path>
            <path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path>
            <line x1="6" y1="1" x2="6" y2="4"></line>
            <line x1="10" y1="1" x2="10" y2="4"></line>
            <line x1="14" y1="1" x2="14" y2="4"></line>
        </svg>
    );

    const BarChart3 = ({ className }) => (
        <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
            <path d="M3 3v18h18"></path>
            <path d="M18 17V9"></path>
            <path d="M13 17V5"></path>
            <path d="M8 17v-3"></path>
        </svg>
    );

    const Download = ({ className }) => (
        <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
    );

    const TeaRecommendation = () => {
        const [step, setStep] = useState(0);
        const [answers, setAnswers] = useState({
            concern: '',
            timing: '',
            flavor: '',
            desire: ''
        });
        const [showAdmin, setShowAdmin] = useState(false);
        const [isAuthenticated, setIsAuthenticated] = useState(false);
        const [passwordInput, setPasswordInput] = useState('');
        const [passwordError, setPasswordError] = useState('');

        const ADMIN_PASSWORD = '2512diag_yrs';

        useEffect(() => {
            const urlParams = new URLSearchParams(window.location.search);
            const adminParam = urlParams.get('admin');
            
            if (adminParam === 'true') {
                setShowAdmin(true);
            }
            
            const handleKeyPress = (e) => {
                if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                    e.preventDefault();
                    console.log('ÁÆ°ÁêÜÁîªÈù¢„É¢„Éº„Éâ„ÇíÊúâÂäπÂåñÔºà„Ç≠„Éº„Éú„Éº„Éâ„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„ÉàÔºâ');
                    setShowAdmin(true);
                }
            };
            
            window.addEventListener('keydown', handleKeyPress);
            
            return () => {
                window.removeEventListener('keydown', handleKeyPress);
            };
        }, []);

        const handlePasswordSubmit = () => {
            if (passwordInput === ADMIN_PASSWORD) {
                setIsAuthenticated(true);
                setPasswordError('');
            } else {
                setPasswordError('„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì');
                setPasswordInput('');
            }
        };

        const handlePasswordKeyPress = (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                handlePasswordSubmit();
            }
        };

        const questions = [
            {
                id: 'concern',
                title: '„ÅÑ„ÅæÊ∞ó„Å´„Å™„Çã„Åì„Å®„ÅØÔºü',
                subtitle: 'ÁèæÂú®„ÅÆÁä∂ÊÖã„ÇÑÊ∞ó„Å´„Å™„Çã„Åì„Å®„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ',
                options: [
                    { value: 'circulation', label: 'Ê∏©„Åæ„Çä„Åü„ÅÑ„ÉªÂ∑°„Çä„Çí„Çà„Åè„Åó„Åü„ÅÑ', emoji: 'üî•', result: 1 },
                    { value: 'snack', label: 'Áîò„ÅÑ„ÇÇ„ÅÆ„Åå„Åª„Åó„ÅÑ„ÉªÈñìÈ£ü„ÅåÂ¢ó„Åà„Åå„Å°', emoji: 'üç´', result: 2 },
                    { value: 'sleep', label: 'Áú†„Çä„ÅÆÊµÖ„Åï„ÉªÁ∑äÂºµ„Éª‰ºë„Åæ„Çâ„Å™„ÅÑ', emoji: 'üò¥', result: 3 },
                    { value: 'tired', label: '„Å†„Çã„Åï„ÉªÁñ≤„Çå„ÉªÊ∞óÂàÜ„ÅÆÂàá„ÇäÊõø„Åà„Åå„Åó„Åü„ÅÑ', emoji: '‚ö°', result: 4 }
                ]
            },
            {
                id: 'timing',
                title: 'È£≤„Åø„Åü„ÅÑ„Çø„Ç§„Éü„É≥„Ç∞„Å´Ëøë„ÅÑ„ÅÆ„ÅØÔºü',
                subtitle: '„ÅÑ„Å§È£≤„ÇÄ„Åì„Å®„ÅåÂ§ö„ÅÑ„Åß„Åô„Åã',
                options: [
                    { value: 'morning', label: 'Êúù„ÄúÊó•‰∏≠', emoji: '‚òÄÔ∏è', result: 4 },
                    { value: 'snack', label: 'È£üÂæå„ÄÅ„Åä„ÇÑ„Å§„ÅÆ‰ª£„Çè„Çä', emoji: 'üç™', result: 2 },
                    { value: 'night', label: 'Â§ú„ÅÆ„É™„É©„ÉÉ„ÇØ„Çπ', emoji: 'üåô', result: 3 },
                    { value: 'anytime', label: '„ÅÑ„Å§„Åß„ÇÇÈ£≤„Åø„ÇÑ„Åô„ÅÑ„ÇÇ„ÅÆ', emoji: 'üïê', result: 1 }
                ]
            },
            {
                id: 'flavor',
                title: 'Â•Ω„Åø„ÅÆÈ¢®Âë≥',
                subtitle: '„Å©„Çì„Å™Âë≥„Çè„ÅÑ„ÅåÂ•Ω„Åç„Åß„Åô„Åã',
                options: [
                    { value: 'refreshing', label: 'È¶ô„Å∞„Åó„ÅÑ„Éª„Åô„Å£„Åç„Çä', emoji: 'üåø', result: 1 },
                    { value: 'rich', label: 'ÊøÉÂéö„Éª„Ç≥„ÇØ„ÅÆ„ÅÇ„Çã', emoji: 'üçÇ', result: 2 },
                    { value: 'gentle', label: '„ÇÑ„Åï„Åó„ÅÑ„ÉªËêΩ„Å°ÁùÄ„ÅèÈ¶ô„Çä', emoji: 'üå∏', result: 3 },
                    { value: 'fruity', label: '„Éï„É´„Éº„ÉÜ„Ç£„Éº„ÉªÁàΩ„ÇÑ„Åã', emoji: 'üçä', result: 4 }
                ]
            },
            {
                id: 'desire',
                title: '„Å©„Å°„Çâ„Åã„Å®„ÅÑ„ÅÜ„Å®„ÄÅ„ÅÑ„ÅæÊ¨≤„Åó„ÅÑ„ÅÆ„ÅØÔºü',
                subtitle: 'ÊúüÂæÖ„Åô„ÇãÂäπÊûú„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ',
                options: [
                    { value: 'warmth', label: '‰Ωì„ÇíÊï¥„Åà„ÇãÊ∏©Ê¥ª„ÉªÂ∑°„Çä„Ç±„Ç¢', emoji: '‚ô®Ô∏è', result: 1 },
                    { value: 'satisfy', label: '„Åä„ÇÑ„Å§‰ª£„Çè„Çä„Å´„Å™„ÇãÊ∫ÄË∂≥ÊÑü', emoji: 'üòã', result: 2 },
                    { value: 'rest', label: 'ÂøÉ„ÅÆ‰ºëÊÅØ„ÉªÁù°Áú†„ÅÆ„Çµ„Éù„Éº„Éà', emoji: 'üßò', result: 3 },
                    { value: 'energy', label: 'ÂÖÉÊ∞ó„Éª„É™„Éï„É¨„ÉÉ„Ç∑„É•ÊÑü', emoji: '‚ú®', result: 4 }
                ]
            }
        ];

        const results = {
            1: {
                name: '„Éá„Éà„ÉÉ„ÇØ„Çπ„Éï„É≠„Éº',
                subtitle: 'ÂÜ∑„Åà„ÉªÂ∑°„ÇäÁ≥ª',
                blend: ['„Çà„ÇÇ„Åé', '„Éç„Éà„É´', '„Éï„Çß„É≥„Éç„É´'],
                description: '‰Ωì„ÇíËäØ„Åã„ÇâÊ∏©„ÇÅ„ÄÅË°Ä„ÅÆÂ∑°„Çä„ÇíÊï¥„Åà„ÇãÊ∏©Ê¥ª„Éñ„É¨„É≥„Éâ„ÄÇ„Çà„ÇÇ„Åé„ÅÆÊ∏©„ÇÅÂäπÊûú„Å®„Éç„Éà„É´„ÅÆÊ†ÑÈ§ä„ÄÅ„Éï„Çß„É≥„Éç„É´„ÅÆÂ∑°„ÇäÊîπÂñÑ„ÅåÁµÑ„ÅøÂêà„Çè„Åï„Çä„ÄÅ‰Ωì„ÅÆÂÜÖÂÅ¥„Åã„ÇâÊï¥„Åà„Åæ„Åô„ÄÇ',
                benefits: ['Ë°ÄË°å‰øÉÈÄ≤', 'ÂÜ∑„ÅàÊÄßÊîπÂñÑ', '„Éá„Éà„ÉÉ„ÇØ„ÇπÂäπÊûú', '‰ΩìË≥™ÊîπÂñÑ'],
                bestFor: 'ÂÜ∑„Åà„ÅåÊ∞ó„Å´„Å™„ÇãÊñπ„ÄÅÂ∑°„Çä„ÇíËâØ„Åè„Åó„Åü„ÅÑÊñπ'
            },
            2: {
                name: 'È£ü„Åπ„Çâ„Çå„ÇãÈªíË±Ü„Ç´„Ç´„Ç™',
                subtitle: 'È£ü„Åπ„Çâ„Çå„Çã„ÅäËå∂',
                blend: ['ÈªíË±Ü', '„Ç´„Ç´„Ç™„Éã„Éñ'],
                description: 'È¶ô„Å∞„Åó„ÅÑÈªíË±Ü„Å®„Ç´„Ç´„Ç™„Éã„Éñ„ÅÆÊøÉÂéö„Å™Âë≥„Çè„ÅÑ„ÄÇ„Åù„ÅÆ„Åæ„ÅæÈ£ü„Åπ„Çã„Åì„Å®„ÇÇ„Åß„Åç„ÇãÊ∫ÄË∂≥ÊÑü„ÅÆ„ÅÇ„Çã„Éñ„É¨„É≥„Éâ„ÄÇ„Åä„ÇÑ„Å§„ÅÆ‰ª£„Çè„Çä„Å´„Å¥„Å£„Åü„Çä„Åß„ÄÅÁΩ™ÊÇ™ÊÑü„Å™„ÅèÊ•Ω„Åó„ÇÅ„Åæ„Åô„ÄÇ',
                benefits: ['Ê∫ÄË∂≥ÊÑü', 'Ê†ÑÈ§äË£úÁµ¶', '„Éù„É™„Éï„Çß„Éé„Éº„É´Ë±äÂØå', 'È£üÁâ©ÁπäÁ∂≠'],
                bestFor: 'ÈñìÈ£ü„ÇíÊéß„Åà„Åü„ÅÑÊñπ„ÄÅ„Åä„ÇÑ„Å§‰ª£„Çè„Çä„ÇíÊé¢„Åó„Å¶„ÅÑ„ÇãÊñπ'
            },
            3: {
                name: 'Áù°Áú†ÔºÜÁôí„Åó',
                subtitle: '„Åø„Åã„ÇìÁöÆ√ó„Ç´„É¢„Éü„Éº„É´',
                blend: ['„Åø„Åã„Çì„ÅÆÁöÆ', '„Ç´„É¢„Éü„Éº„É´', '„É¨„É¢„É≥„Éê„Éº„É†', '„Éè„Éà„É†„ÇÆ'],
                description: '„Åø„Åã„Çì„ÅÆÁöÆ„ÅÆÂÑ™„Åó„ÅÑÈ¶ô„Çä„Å®„Ç´„É¢„Éü„Éº„É´„ÅÆÁôí„ÅóÂäπÊûú„ÅåÂøÉ„ÇíËêΩ„Å°ÁùÄ„Åã„Åõ„Åæ„Åô„ÄÇ„É¨„É¢„É≥„Éê„Éº„É†„Å®„Éè„Éà„É†„ÇÆ„ÅåÂä†„Çè„Çä„ÄÅÊ∑±„ÅÑ„É™„É©„ÉÉ„ÇØ„Çπ„Å®ËâØË≥™„Å™Áù°Áú†„Çí„Çµ„Éù„Éº„Éà„Åó„Åæ„Åô„ÄÇ',
                benefits: ['Áù°Áú†„ÅÆË≥™Âêë‰∏ä', 'Ê∑±„ÅÑ„É™„É©„ÉÉ„ÇØ„Çπ', 'Á∑äÂºµÁ∑©Âíå', 'ÂøÉ„ÅÆÂÆâÂÆö'],
                bestFor: 'Áú†„Çä„ÅåÊµÖ„ÅÑÊñπ„ÄÅÁ∑äÂºµ„Åó„ÇÑ„Åô„ÅÑÊñπ„ÄÅÂøÉ„Çí‰ºë„ÇÅ„Åü„ÅÑÊñπ'
            },
            4: {
                name: 'ÂçàÂæå„ÅÆ„É™„Éï„É¨„ÉÉ„Ç∑„É•',
                subtitle: 'Á∑ëËå∂√ó„Éè„Ç§„Éì„Çπ„Ç´„Çπ',
                blend: ['Á∑ëËå∂', '„Ç´„É¢„Éü„Éº„É´', '„Éè„Ç§„Éì„Çπ„Ç´„Çπ'],
                description: 'Á∑ëËå∂„ÅÆÁàΩ„ÇÑ„Åã„Åï„Å®„Éè„Ç§„Éì„Çπ„Ç´„Çπ„ÅÆËèØ„ÇÑ„Åã„Å™ÈÖ∏Âë≥„ÅåÊ∞óÂàÜ„Çí„É™„Éï„É¨„ÉÉ„Ç∑„É•„ÄÇ„Ç´„É¢„Éü„Éº„É´„ÅåÂÑ™„Åó„ÅèË™øÂíå„Åó„ÄÅÁñ≤„Çå„ÅüÂøÉË∫´„Å´Ê¥ªÂäõ„Çí‰∏é„Åà„Åæ„Åô„ÄÇ',
                benefits: ['„É™„Éï„É¨„ÉÉ„Ç∑„É•ÂäπÊûú', 'ÁæéÂÆπ„Çµ„Éù„Éº„Éà', '„Éì„Çø„Éü„É≥CË£úÁµ¶', 'Ê∞óÂàÜËª¢Êèõ'],
                bestFor: '„Å†„Çã„Åï„ÇíÊÑü„Åò„ÇãÊñπ„ÄÅÊ∞óÂàÜ„ÇíÂàá„ÇäÊõø„Åà„Åü„ÅÑÊñπ„ÄÅÁæéÂÆπ„ÇíÊÑèË≠ò„Åô„ÇãÊñπ'
            }
        };

        const handleAnswer = async (questionId, value, resultValue) => {
            const newAnswers = { ...answers, [questionId]: value };
            setAnswers(newAnswers);

            if (step < 3) {
                setTimeout(() => setStep(step + 1), 300);
            } else {
                const scores = { 1: 0, 2: 0, 3: 0, 4: 0 };
                
                questions.forEach(q => {
                    const answer = q.id === questionId ? value : newAnswers[q.id];
                    const option = q.options.find(opt => opt.value === answer);
                    if (option) {
                        scores[option.result]++;
                    }
                });

                const maxScore = Math.max(...Object.values(scores));
                const resultId = parseInt(Object.keys(scores).find(key => scores[key] === maxScore));

                setTimeout(() => setStep(4), 300);

                saveResponse(newAnswers, resultId).catch(err => {
                    console.log('„Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„Éâ„Éá„Éº„Çø‰øùÂ≠ò:', err.message || err);
                });
            }
        };

        const saveResponse = async (answersData, resultId) => {
            try {
                // LocalStorage„Çí‰ΩøÁî®ÔºàGitHub Pages„Åß„ÇÇÂãï‰ΩúÔºâ
                let stats = {
                    total: 0,
                    concernData: { circulation: 0, snack: 0, sleep: 0, tired: 0 },
                    timingData: { morning: 0, snack: 0, night: 0, anytime: 0 },
                    flavorData: { refreshing: 0, rich: 0, gentle: 0, fruity: 0 },
                    desireData: { warmth: 0, satisfy: 0, rest: 0, energy: 0 },
                    resultData: { '1': 0, '2': 0, '3': 0, '4': 0 }
                };
                
                const existingData = localStorage.getItem('yuras_analytics_data');
                if (existingData) {
                    const loadedData = JSON.parse(existingData);
                    stats = {
                        total: loadedData.total || 0,
                        concernData: loadedData.concernData || stats.concernData,
                        timingData: loadedData.timingData || stats.timingData,
                        flavorData: loadedData.flavorData || stats.flavorData,
                        desireData: loadedData.desireData || stats.desireData,
                        resultData: loadedData.resultData || stats.resultData
                    };
                }
                
                stats.total += 1;
                stats.concernData[answersData.concern] = (stats.concernData[answersData.concern] || 0) + 1;
                stats.timingData[answersData.timing] = (stats.timingData[answersData.timing] || 0) + 1;
                stats.flavorData[answersData.flavor] = (stats.flavorData[answersData.flavor] || 0) + 1;
                stats.desireData[answersData.desire] = (stats.desireData[answersData.desire] || 0) + 1;
                
                const resultKey = String(resultId);
                stats.resultData[resultKey] = (stats.resultData[resultKey] || 0) + 1;
                
                localStorage.setItem('yuras_analytics_data', JSON.stringify(stats));
                
            } catch (error) {
                console.log('„Éá„Éº„Çø‰øùÂ≠òÂ§±ÊïóÔºàÁÑ°Ë¶ñÔºâ:', error);
            }
        };

        const getRecommendation = () => {
            const scores = { 1: 0, 2: 0, 3: 0, 4: 0 };
            
            questions.forEach(q => {
                const answer = answers[q.id];
                const option = q.options.find(opt => opt.value === answer);
                if (option) {
                    scores[option.result]++;
                }
            });

            const maxScore = Math.max(...Object.values(scores));
            const resultId = parseInt(Object.keys(scores).find(key => scores[key] === maxScore));
            
            return results[resultId];
        };

        const reset = () => {
            setStep(0);
            setAnswers({ concern: '', timing: '', flavor: '', desire: '' });
        };

        const exportToCSV = () => {
            try {
                const existingData = localStorage.getItem('yuras_analytics_data');
                if (!existingData) {
                    alert('„Åæ„Å†„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                    return;
                }
                
                const stats = JSON.parse(existingData);
                const total = stats.total || 0;
                
                let csvContent = '\uFEFF';
                csvContent += 'YURASÊó•Êú¨„Éè„Éº„Éñ„ÉÜ„Ç£„ÉºË®∫Êñ≠ ÈõÜË®à„Éá„Éº„Çø\n\n';
                csvContent += `Á∑èÂõûÁ≠îÊï∞,${total}\n`;
                csvContent += `„Ç®„ÇØ„Çπ„Éù„Éº„ÉàÊó•ÊôÇ,${new Date().toLocaleString('ja-JP')}\n\n`;
                
                csvContent += '„Äê„ÅÑ„ÅæÊ∞ó„Å´„Å™„Çã„Åì„Å®„ÅØÔºü„Äë\n';
                csvContent += 'ÈÅ∏ÊäûËÇ¢,ÂõûÁ≠îÊï∞,Ââ≤Âêà\n';
                const concernLabels = {
                    circulation: 'Ê∏©„Åæ„Çä„Åü„ÅÑ„ÉªÂ∑°„Çä„Çí„Çà„Åè„Åó„Åü„ÅÑ',
                    snack: 'Áîò„ÅÑ„ÇÇ„ÅÆ„Åå„Åª„Åó„ÅÑ„ÉªÈñìÈ£ü„ÅåÂ¢ó„Åà„Åå„Å°',
                    sleep: 'Áú†„Çä„ÅÆÊµÖ„Åï„ÉªÁ∑äÂºµ„Éª‰ºë„Åæ„Çâ„Å™„ÅÑ',
                    tired: '„Å†„Çã„Åï„ÉªÁñ≤„Çå„ÉªÊ∞óÂàÜ„ÅÆÂàá„ÇäÊõø„Åà„Åå„Åó„Åü„ÅÑ'
                };
                Object.entries(concernLabels).forEach(([key, label]) => {
                    const count = stats.concernData[key] || 0;
                    const percentage = total > 0 ? ((count / total) * 100).toFixed(1) : '0.0';
                    csvContent += `${label},${count},${percentage}%\n`;
                });
                
                csvContent += '\n„ÄêÈ£≤„Åø„Åü„ÅÑ„Çø„Ç§„Éü„É≥„Ç∞„Äë\n';
                csvContent += 'ÈÅ∏ÊäûËÇ¢,ÂõûÁ≠îÊï∞,Ââ≤Âêà\n';
                const timingLabels = {
                    morning: 'Êúù„ÄúÊó•‰∏≠',
                    snack: 'È£üÂæå„ÄÅ„Åä„ÇÑ„Å§„ÅÆ‰ª£„Çè„Çä',
                    night: 'Â§ú„ÅÆ„É™„É©„ÉÉ„ÇØ„Çπ',
                    anytime: '„ÅÑ„Å§„Åß„ÇÇÈ£≤„Åø„ÇÑ„Åô„ÅÑ„ÇÇ„ÅÆ'
                };
                Object.entries(timingLabels).forEach(([key, label]) => {
                    const count = stats.timingData[key] || 0;
                    const percentage = total > 0 ? ((count / total) * 100).toFixed(1) : '0.0';
                    csvContent += `${label},${count},${percentage}%\n`;
                });
                
                csvContent += '\n„ÄêÂ•Ω„Åø„ÅÆÈ¢®Âë≥„Äë\n';
                csvContent += 'ÈÅ∏ÊäûËÇ¢,ÂõûÁ≠îÊï∞,Ââ≤Âêà\n';
                const flavorLabels = {
                    refreshing: 'È¶ô„Å∞„Åó„ÅÑ„Éª„Åô„Å£„Åç„Çä',
                    rich: 'ÊøÉÂéö„Éª„Ç≥„ÇØ„ÅÆ„ÅÇ„Çã',
                    gentle: '„ÇÑ„Åï„Åó„ÅÑ„ÉªËêΩ„Å°ÁùÄ„ÅèÈ¶ô„Çä',
                    fruity: '„Éï„É´„Éº„ÉÜ„Ç£„Éº„ÉªÁàΩ„ÇÑ„Åã'
                };
                Object.entries(flavorLabels).forEach(([key, label]) => {
                    const count = stats.flavorData[key] || 0;
                    const percentage = total > 0 ? ((count / total) * 100).toFixed(1) : '0.0';
                    csvContent += `${label},${count},${percentage}%\n`;
                });
                
                csvContent += '\n„Äê„ÅÑ„ÅæÊ¨≤„Åó„ÅÑ„ÇÇ„ÅÆ„Äë\n';
                csvContent += 'ÈÅ∏ÊäûËÇ¢,ÂõûÁ≠îÊï∞,Ââ≤Âêà\n';
                const desireLabels = {
                    warmth: '‰Ωì„ÇíÊï¥„Åà„ÇãÊ∏©Ê¥ª„ÉªÂ∑°„Çä„Ç±„Ç¢',
                    satisfy: '„Åä„ÇÑ„Å§‰ª£„Çè„Çä„Å´„Å™„ÇãÊ∫ÄË∂≥ÊÑü',
                    rest: 'ÂøÉ„ÅÆ‰ºëÊÅØ„ÉªÁù°Áú†„ÅÆ„Çµ„Éù„Éº„Éà',
                    energy: 'ÂÖÉÊ∞ó„Éª„É™„Éï„É¨„ÉÉ„Ç∑„É•ÊÑü'
                };
                Object.entries(desireLabels).forEach(([key, label]) => {
                    const count = stats.desireData[key] || 0;
                    const percentage = total > 0 ? ((count / total) * 100).toFixed(1) : '0.0';
                    csvContent += `${label},${count},${percentage}%\n`;
                });
                
                csvContent += '\n„ÄêË®∫Êñ≠ÁµêÊûúÔºàÊèêÊ°à„Åï„Çå„Åü„Éñ„É¨„É≥„ÉâÔºâ„Äë\n';
                csvContent += '„Éñ„É¨„É≥„ÉâÂêç,ÊèêÊ°àÂõûÊï∞,Ââ≤Âêà\n';
                const resultLabels = {
                    '1': '„Éá„Éà„ÉÉ„ÇØ„Çπ„Éï„É≠„Éº',
                    '2': 'È£ü„Åπ„Çâ„Çå„ÇãÈªíË±Ü„Ç´„Ç´„Ç™',
                    '3': 'Áù°Áú†ÔºÜÁôí„Åó',
                    '4': 'ÂçàÂæå„ÅÆ„É™„Éï„É¨„ÉÉ„Ç∑„É•'
                };
                Object.entries(resultLabels).forEach(([key, label]) => {
                    const count = (stats.resultData && stats.resultData[key]) || 0;
                    const percentage = total > 0 ? ((count / total) * 100).toFixed(1) : '0.0';
                    csvContent += `${label},${count},${percentage}%\n`;
                });
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `yuras_tea_diagnosis_${new Date().toISOString().slice(0, 10)}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
            } catch (error) {
                console.error('CSV„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Ç®„É©„Éº:', error);
                alert('„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        };

        const AdminDashboard = () => {
            const [stats, setStats] = useState(null);
            const [loading, setLoading] = useState(true);
            
            useEffect(() => {
                loadStats();
            }, []);
            
            const loadStats = () => {
                try {
                    let stats = {
                        total: 0,
                        concernData: { circulation: 0, snack: 0, sleep: 0, tired: 0 },
                        timingData: { morning: 0, snack: 0, night: 0, anytime: 0 },
                        flavorData: { refreshing: 0, rich: 0, gentle: 0, fruity: 0 },
                        desireData: { warmth: 0, satisfy: 0, rest: 0, energy: 0 },
                        resultData: { '1': 0, '2': 0, '3': 0, '4': 0 }
                    };
                    
                    const existingData = localStorage.getItem('yuras_analytics_data');
                    if (existingData) {
                        const loadedStats = JSON.parse(existingData);
                        stats = {
                            ...stats,
                            ...loadedStats,
                            concernData: { ...stats.concernData, ...(loadedStats.concernData || {}) },
                            timingData: { ...stats.timingData, ...(loadedStats.timingData || {}) },
                            flavorData: { ...stats.flavorData, ...(loadedStats.flavorData || {}) },
                            desireData: { ...stats.desireData, ...(loadedStats.desireData || {}) },
                            resultData: { ...stats.resultData, ...(loadedStats.resultData || {}) }
                        };
                    }
                    
                    setStats(stats);
                    setLoading(false);
                } catch (error) {
                    console.error('Áµ±Ë®àË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                    setStats({
                        total: 0,
                        concernData: { circulation: 0, snack: 0, sleep: 0, tired: 0 },
                        timingData: { morning: 0, snack: 0, night: 0, anytime: 0 },
                        flavorData: { refreshing: 0, rich: 0, gentle: 0, fruity: 0 },
                        desireData: { warmth: 0, satisfy: 0, rest: 0, energy: 0 },
                        resultData: { '1': 0, '2': 0, '3': 0, '4': 0 }
                    });
                    setLoading(false);
                }
            };
            
            if (loading) {
                return (
                    <div className="text-center py-12">
                        <div className="animate-spin rounded-full h-12 w-12 border-b-2 mx-auto" style={{ borderColor: '#2e4f82' }}></div>
                        <p className="mt-4 text-gray-600">„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...</p>
                    </div>
                );
            }
            
            if (!stats || stats.total === 0) {
                return (
                    <div className="space-y-6">
                        <div className="bg-white rounded-2xl p-8 shadow-lg text-center">
                            <p className="text-gray-600 mb-4">„Éá„Éº„Çø„Åå„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                            <p className="text-sm text-gray-500">Ë®∫Êñ≠„ÅÆÂõûÁ≠î„ÅåÈÄÅ‰ø°„Åï„Çå„Çã„Å®„ÄÅ„Åì„Åì„Å´Áµ±Ë®à„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô</p>
                        </div>
                        <button
                            onClick={() => setShowAdmin(false)}
                            className="w-full py-4 rounded-xl border-2 font-semibold text-lg hover:bg-gray-50 transition-colors"
                            style={{ borderColor: '#2e4f82', color: '#2e4f82' }}
                        >
                            Ë®∫Êñ≠„Å´Êàª„Çã
                        </button>
                    </div>
                );
            }
            
            const resultLabels = {
                '1': '„Éá„Éà„ÉÉ„ÇØ„Çπ„Éï„É≠„Éº',
                '2': 'È£ü„Åπ„Çâ„Çå„ÇãÈªíË±Ü„Ç´„Ç´„Ç™',
                '3': 'Áù°Áú†ÔºÜÁôí„Åó',
                '4': 'ÂçàÂæå„ÅÆ„É™„Éï„É¨„ÉÉ„Ç∑„É•'
            };
            
            return (
                <div className="space-y-6">
                    <div className="bg-white rounded-2xl p-6 shadow-lg">
                        <h3 className="text-2xl font-bold mb-2" style={{ color: '#2e4f82' }}>
                            Á∑èÂõûÁ≠îÊï∞
                        </h3>
                        <p className="text-5xl font-bold" style={{ color: '#d7a62b' }}>
                            {stats.total}
                        </p>
                    </div>
                    
                    <div className="bg-white rounded-2xl p-6 shadow-lg">
                        <h3 className="text-xl font-bold mb-4" style={{ color: '#2e4f82' }}>
                            Ë®∫Êñ≠ÁµêÊûú„ÅÆÂàÜÂ∏É
                        </h3>
                        <div className="space-y-3">
                            {Object.entries(resultLabels).map(([id, label]) => {
                                const count = (stats.resultData && stats.resultData[id]) || 0;
                                return (
                                    <div key={id}>
                                        <div className="flex justify-between mb-1">
                                            <span className="text-gray-700">{label}</span>
                                            <span className="font-semibold">{count}Âõû</span>
                                        </div>
                                        <div className="w-full bg-gray-200 rounded-full h-2">
                                            <div 
                                                className="h-2 rounded-full transition-all"
                                                style={{ 
                                                    width: `${stats.total > 0 ? (count / stats.total) * 100 : 0}%`,
                                                    backgroundColor: '#2e4f82'
                                                }}
                                            />
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                    
                    <button
                        onClick={exportToCSV}
                        className="w-full py-4 rounded-xl text-white font-semibold text-lg hover:opacity-90 transition-opacity flex items-center justify-center gap-2"
                        style={{ backgroundColor: '#2e4f82' }}
                    >
                        <Download className="w-5 h-5" />
                        Ë©≥Á¥∞„Éá„Éº„Çø„ÇíCSV„Åß„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
                    </button>
                    
                    <button
                        onClick={() => setShowAdmin(false)}
                        className="w-full py-4 rounded-xl border-2 font-semibold text-lg hover:bg-gray-50 transition-colors"
                        style={{ borderColor: '#2e4f82', color: '#2e4f82' }}
                    >
                        Ë®∫Êñ≠„Å´Êàª„Çã
                    </button>
                </div>
            );
        };

        const currentQuestion = step < 4 ? questions[step] : null;
        const recommendation = step === 4 ? getRecommendation() : null;

        return (
            <div className="min-h-screen bg-gradient-to-br from-slate-50 to
              
              <form onSubmit={(e) => e.preventDefault()}>
                                        <input
                                            type="password"
                                            value={passwordInput}
                                            onChange={(e) => setPasswordInput(e.target.value)}
                                            onKeyPress={handlePasswordKeyPress}
                                            placeholder="„Éë„Çπ„ÉØ„Éº„Éâ"
                                            className="w-full px-4 py-3 border-2 rounded-xl mb-4 text-lg focus:outline-none focus:border-opacity-50"
                                            style={{ borderColor: passwordError ? '#ef4444' : '#e5e7eb' }}
                                            autoFocus
                                        />
                                        
                                        {passwordError && (
                                            <p className="text-red-500 text-sm mb-4">{passwordError}</p>
                                        )}
                                        
                                        <button
                                            type="button"
                                            onClick={handlePasswordSubmit}
                                            className="w-full py-4 rounded-xl text-white font-semibold text-lg hover:opacity-90 transition-opacity"
                                            style={{ backgroundColor: '#2e4f82' }}
                                        >
                                            „É≠„Ç∞„Ç§„É≥
                                        </button>
                                        
                                        <button
                                            type="button"
                                            onClick={() => setShowAdmin(false)}
                                            className="w-full mt-3 py-4 rounded-xl border-2 font-semibold text-lg hover:bg-gray-50 transition-colors"
                                            style={{ borderColor: '#2e4f82', color: '#2e4f82' }}
                                        >
                                            Ë®∫Êñ≠„Å´Êàª„Çã
                                        </button>
                                    </form>
                                </div>
                            ) : (
                                <>
                                    <h1 className="text-4xl font-bold mb-8" style={{ color: '#2e4f82' }}>
                                        üìä ÁÆ°ÁêÜËÄÖ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ
                                    </h1>
                                    <AdminDashboard />
                                </>
                            )}
                        </div>
                    ) : (
                        <>
                            <div className="mb-8">
                                <div className="h-1 bg-gray-200 rounded-full overflow-hidden">
                                    <div 
                                        className="h-full transition-all duration-500 ease-out"
                                        style={{
                                            width: `${(step / 4) * 100}%`,
                                            backgroundColor: '#2e4f82'
                                        }}
                                    />
                                </div>
                            </div>

                            {step === 0 && (
                                <div className="animate-fade-in mb-10">
                                    <h1 className="text-3xl md:text-4xl font-bold mb-6 text-center" style={{ color: '#2e4f82' }}>
                                        YURASÊó•Êú¨„Éè„Éº„Éñ„ÉÜ„Ç£„ÉºË®∫Êñ≠
                                    </h1>
                                    
                                    <div className="mb-10 p-6 bg-white rounded-2xl shadow-sm">
                                        <p className="text-gray-800 leading-relaxed mb-4">
                                            YURAS„ÅÆÊó•Â∏∏„Å´ÂØÑ„ÇäÊ∑ª„ÅÜ„ÅäËå∂Ë®∫Êñ≠„Å∏„Çà„ÅÜ„Åì„ÅùÔºÅ<br />
                                            „ÅÑ„Åæ„ÅÆ„ÅÇ„Å™„Åü„Å´„ÅÇ„ÅÜ„Éñ„É¨„É≥„Éâ„ÉÜ„Ç£„Éº„Çí„ÅÑ„Åè„Å§„Åã„ÅÆË≥™Âïè„Åã„Çâ„ÅîÊèêÊ°à„Åó„Åæ„Åô„ÄÇ
                                        </p>
                                        <p className="text-gray-700 mb-4">
                                            <span className="font-semibold" style={{ color: '#d7a62b' }}>ÊâÄË¶ÅÊôÇÈñì„ÅØÁ¥Ñ1„Äú2ÂàÜ„ÄÇ</span>
                                        </p>
                                        <p className="text-sm text-gray-600 leading-relaxed">
                                            ‚Äª„É≠„Ç∞„Ç§„É≥‰∏çË¶Å„Åß„ÅîÂà©Áî®„ÅÑ„Åü„Å†„Åë„Åæ„Åô„ÄÇÂõûÁ≠î„Éá„Éº„Çø„ÅØÂåøÂêç„ÅßÁµ±Ë®àÁõÆÁöÑ„Å´„ÅÆ„Åø‰ΩøÁî®„Åï„Çå„Åæ„Åô„ÄÇ
                                        </p>
                                    </div>
                                </div>
                            )}

                            {currentQuestion && (
                                <div className="animate-fade-in">
                                    {step > 0 && (
                                        <button
                                            onClick={() => setStep(step - 1)}
                                            className="mb-6 text-gray-600 hover:text-gray-800 flex items-center gap-2 transition-colors"
                                        >
                                            ‚Üê Êàª„Çã
                                        </button>
                                    )}
                                    <h2 className="text-3xl md:text-4xl font-bold mb-3" style={{ color: '#2e4f82' }}>
                                        {currentQuestion.title}
                                    </h2>
                                    <p className="text-gray-600 mb-8 text-base">
                                        {currentQuestion.subtitle}
                                    </p>
                                    <div className="space-y-4">
                                        {currentQuestion.options.map((option) => (
                                            <button
                                                key={option.value}
                                                onClick={() => handleAnswer(currentQuestion.id, option.value, option.result)}
                                                className="w-full p-6 bg-white rounded-2xl shadow-sm hover:shadow-lg transition-all duration-300 flex items-center justify-between group border-2 border-transparent hover-border-gold"
                                            >
                                                <div className="flex items-center gap-4">
                                                    <div 
                                                        className="w-12 h-12 rounded-full flex items-center justify-center text-2xl"
                                                        style={{ backgroundColor: '#f0f4f8' }}
                                                    >
                                                        {option.emoji}
                                                    </div>
                                                    <span className="text-xl font-medium text-gray-800">
                                                        {option.label}
                                                    </span>
                                                </div>
                                                <ChevronRight 
                                                    className="w-6 h-6 transition-transform group-hover:translate-x-1"
                                                    style={{ color: '#d7a62b' }}
                                                />
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {step === 4 && recommendation && (
                                <div className="animate-fade-in">
                                    <div className="bg-white rounded-3xl shadow-xl p-8 md:p-12">
                                        <div className="text-center mb-8">
                                            <div 
                                                className="w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6"
                                                style={{ backgroundColor: '#d7a62b' }}
                                            >
                                                <Coffee className="w-10 h-10 text-white" />
                                            </div>
                                            <h2 className="text-3xl md:text-4xl font-bold mb-2" style={{ color: '#2e4f82' }}>
                                                {recommendation.name}
                                            </h2>
                                            <p className="text-lg font-medium mb-4" style={{ color: '#d7a62b' }}>
                                                {recommendation.subtitle}
                                            </p>
                                            <p className="text-gray-600 text-lg leading-relaxed">
                                                {recommendation.description}
                                            </p>
                                        </div>

                                        <div className="mb-8">
                                            <h3 className="text-xl font-semibold mb-4" style={{ color: '#2e4f82' }}>
                                                „Éñ„É¨„É≥„ÉâÂÜÖÂÆπ
                                            </h3>
                                            <div className="flex flex-wrap gap-2">
                                                {recommendation.blend.map((ingredient, index) => (
                                                    <span
                                                        key={index}
                                                        className="px-4 py-2 rounded-full text-white font-medium"
                                                        style={{ backgroundColor: '#2e4f82' }}
                                                    >
                                                        {ingredient}
                                                    </span>
                                                ))}
                                            </div>
                                        </div>

                                        <div className="mb-8">
                                            <h3 className="text-xl font-semibold mb-4" style={{ color: '#2e4f82' }}>
                                                ÊúüÂæÖ„Åß„Åç„ÇãÂäπÊûú
                                            </h3>
                                            <div className="space-y-2">
                                                {recommendation.benefits.map((benefit, index) => (
                                                    <div key={index} className="flex items-center gap-3">
                                                        <div 
                                                            className="w-2 h-2 rounded-full"
                                                            style={{ backgroundColor: '#d7a62b' }}
                                                        />
                                                        <span className="text-gray-700">{benefit}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        <div className="mb-8 p-4 bg-amber-50 rounded-xl">
                                            <p className="text-sm text-gray-700 mb-3">
                                                <strong>„Åì„Çì„Å™Êñπ„Å´„Åä„Åô„Åô„ÇÅÔºö</strong> {recommendation.bestFor}
                                            </p>
                                        </div>

                                        <div className="mb-6 p-5 bg-gradient-to-r from-amber-50 to-yellow-50 rounded-xl border-2 border-amber-200">
                                            <p className="text-center mb-2">
                                                <span className="text-lg font-bold" style={{ color: '#d7a62b' }}>üéÅ Ë®∫Êñ≠„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ</span>
                                            </p>
                                            <p className="text-center text-sm text-gray-700 mb-2">
                                                Creema„Åß„ÅîÂà©Áî®„ÅÑ„Åü„Å†„Åë„Çã„ÇØ„Éº„Éù„É≥„Ç≥„Éº„Éâ„Çí„Éó„É¨„Çº„É≥„Éà
                                            </p>
                                            <div className="bg-white rounded-lg p-3 text-center border-2 border-dashed border-amber-300">
                                                <p className="text-xs text-gray-600 mb-1">„ÇØ„Éº„Éù„É≥„Ç≥„Éº„Éâ</p>
                                                <p className="text-2xl font-bold tracking-wider" style={{ color: '#2e4f82' }}>
                                                    10yurasevw
                                                </p>
                                            </div>
                                        </div>

                                        
                                            href="https://www.creema.jp/creator/10645046/item/onsale"
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            className="block w-full py-4 rounded-xl text-white font-semibold text-lg text-center hover:opacity-90 transition-opacity mb-3"
                                            style={{ backgroundColor: '#d7a62b' }}
                                        >
                                            Creema„Åß„ÅîË≥ºÂÖ• ‚Üí
                                        </a>

                                        <button
                                            onClick={reset}
                                            className="w-full py-4 rounded-xl text-white font-semibold text-lg hover:opacity-90 transition-opacity"
                                            style={{ backgroundColor: '#2e4f82' }}
                                        >
                                            „ÇÇ„ÅÜ‰∏ÄÂ∫¶Ë®∫Êñ≠„Åô„Çã
                                        </button>
                                    </div>
                                </div>
                            )}
                        </>
                    )}
                </div>

                <style>{`
                    @keyframes fade-in {
                        from {
                            opacity: 0;
                            transform: translateY(10px);
                        }
                        to {
                            opacity: 1;
                            transform: translateY(0);
                        }
                    }
                    .animate-fade-in {
                        animation: fade-in 0.5s ease-out;
                    }
                    .hover-border-gold:hover {
                        border-color: #d7a62b !important;
                    }
                `}</style>
            </div>
        );
    };

    ReactDOM.render(<TeaRecommendation />, document.getElementById('root'));
</script>
